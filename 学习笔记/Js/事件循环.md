# 浏览器进程模型
## 进程
程序运行需要自己专属的内存空间，这块空间可以理解为进程。
进程是操作系统分配资源的最小单位，每个应用至少有一个进程，进程之间相互独立，即使要通信，也要双方同意。

## 线程
一个进程至少要有一个线程，进程在开启后会自动创建一个线程来运行代码，该线程称之为主线程，主线程结束后，进程也会结束。
如果程序需要同时执行多块代码，主线程就会启动更多的线程来执行代码，这些线程称之为子线程。
线程是操作系统分配CPU的最小单位，线程之间共享进程的资源，包括内存空间和文件句柄等。

## 浏览器的进程与线程
浏览器是一个多进程、多线程的应用程序
浏览器极其复杂，为了避免相互影响，连环崩溃，浏览器内部有多个进程，主要可分为以下几类：浏览器进程（主进程）、网络进程、渲染进程等
浏览器进程：主要负责界面的展示（标签页、前进后退按钮等）、用户交互（点击、按键等）、子进程管理
网络进程：主要负责页面的网络资源加载，之前是作为浏览器进程的一个模块，现在是一个独立的进程
渲染进程：每个标签页都会有一个独立的渲染进程，渲染进程启动后，会开启一个渲染主线程，主线程负责执行js、css、html的代码。（将来可能会改成一个站点一个进程）

# 渲染主线程是如何工作的
## 渲染主线程的工作任务包括但不限于：
解析HTML
解析CSS
计算样式
布局
处理涂层
执行全局JS代码
执行事件处理函数
执行计时器的回调函数
...

## 事件循环
1、渲染主线程无限循环
2、每次循环检查消息队列中是否有任务存在，有的话就取出第一个任务执行，执行完后进入下一次循环；如果没有，则进入休眠状态。
3、其他线程可以随时向消息队列中添加任务，新任务会加到消息队列的末尾。

## 异步
计时完成后执行的任务：setTimeout、setInterVal
网络通信：XHR、Fetch
用户操作后执行的任务：addEventListener

js是一门单线程语言，这是因为它运行在浏览器的渲染主线程中，而渲染主线程只有一个。
但是渲染主线程承担着很多任务，比如渲染页面、执行JS代码、处理用户交互等，如果这些任务都是同步执行的，那么页面就会卡顿，用户体验就会很差。
所以浏览器采用异步的方式，当计时器、网络请求、事件监听等任务发生时，主线程将任务交给其他线程，自身立即结束任务，转而执行后续任务。当其他线程完成后，会将事先传递的回调函数包装成任务，加入到消息队列的末尾，等待主线程调度。

## 任务优先级
W3C解释：
1、每个任务都有一个任务类型，同一个任务必须在一个队列，不同类型的任务可以分属不同队列，在一次事件循环中，浏览器可以根据实际情况从不同的队列中取出任务执行
2、浏览器中必须存在一个微任务队列，微队列中的任务优先其他所有任务执行

chrome实现的队列：
延时队列：存放计时器到达后的回调任务，优先级中
交互队列：存放用户操作后产生的事件处理任务，优先级高
微队列：需要最快执行的任务，优先级最高

添加任务到微队列的的主要方式是使用Peomise、MutationObserver
